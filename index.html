<!DOCTYPE html>
<html>
<head>
    <title>Voice Attendance System</title>
</head>
<body>
    <h2>Voice Attendance System</h2>

    <button onclick="startAttendance()">Start Attendance</button>
    <button onclick="stopAttendance()">Stop</button>

    <p id="status"></p>

    <script>
        const students = ["Arjun", "Riya", "Manoj", "Sneha", "Chandu"];
        let roll = 0;
        const attendance = {};
        let stopped = false;
        let recognition;

        function speak(text) {
            const msg = new SpeechSynthesisUtterance(text);
            window.speechSynthesis.speak(msg);
        }

        function listen(callback) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.lang = "en-IN";
            recognition.interimResults = false;
            recognition.continuous = false;

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.toLowerCase();
                callback(transcript);
            };

            recognition.onerror = () => {
                callback(""); 
            };

            recognition.start();
        }

        function stopAttendance() {
            stopped = true;
            if (recognition) recognition.stop();
            speak("Attendance stopped");
            document.getElementById("status").innerText =
                "Attendance Stopped!\n" + JSON.stringify(attendance, null, 2);
        }

        function startAttendance() {
            stopped = false;
            roll = 0;
            callNextStudent();
        }

        function callNextStudent() {
            if (stopped) return;

            if (roll >= students.length) {
                speak("Attendance completed");
                document.getElementById("status").innerText = "Attendance Completed!";
                console.log(attendance);
                return;
            }

            const name = students[roll];
            speak(`Roll number ${roll+1}, ${name}`);
            document.getElementById("status").innerText = `Calling: Roll ${roll+1} - ${name}`;

            setTimeout(() => {
                if (stopped) return;

                speak("Say Present");
                listen((response) => {

                    if (response.includes("present")) {
                        attendance[name] = "Present";
                        speak("Marked Present");
                    } else {
                        attendance[name] = "Absent";
                        speak("Marked Absent");
                    }

                    roll++;
                    callNextStudent();
                });
            }, 1500);
        }
    </script>
</body>
</html>